version: '3'
 
services:
   database:
     image: mariadb:10.0.29
     volumes:
       - volume_database:/var/lib/mysql
     restart: always
     environment:
       - MYSQL_ROOT_PASSWORD=abc123
       - MYSQL_DATABASE=sito
       - MYSQL_USER=user_sito
       - MYSQL_PASSWORD=abc123
     networks:
       - BackEnd
       
       
   prometheus:
     #image: prom/prometheus:v2.5.0-rc.2
     image: prom/prometheus:latest
   #  build:
    # context: ./prometheus
    # dockerfile: Dockerfile
     expose:
       - 9090
     ports:
        - 9090:9090
     volumes:
     # - ./prometheus/:/etc/prometheus/ # map path where yalm file for prom is stored
       - volume_prometheus:/etc/prometheus/
       - volume_pro:/var/lib/prometheus  # where store data
       - prometheus_pro:/prometheus
     command:
       - --config.file=/etc/prometheus/prometheus.yml
       - "--storage.tsdb.path=/prometheus"
       - "--web.console.libraries=/etc/prometheus/console_libraries"
       - "--web.console.templates=/etc/prometheus/consoles"
       - "--storage.tsdb.retention=200h"
       - "--web.enable-lifecycle"

     depends_on:
       - cadvisor


   sito:
     depends_on:
       - database
     image: wordpress:4.7.2-apache
     ports:
       - "80:80"
     restart: always
     volumes:
           - volume_sito:/var/www/html
     environment:
       - WORDPRESS_DB_HOST=database
       - WORDPRESS_DB_NAME=sito
       - WORDPRESS_DB_USER=user_sito
       - WORDPRESS_DB_PASSWORD=abc123
     networks:
       - FrontEnd
       - BackEnd
       
   grafana:
     container_name: grafana
     image: grafana/grafana:latest
     volumes:
       - grafana_data:/var/lib/grafana
     environment:
       - GF_SECURITY_ADMIN_USER=${ADMIN_USER:-user}
       - GF_SECURITY_ADMIN_PASSWORD=${ADMIN_PASSWORD:-user}
       - GF_USERS_ALLOW_SIGN_UP=false
     restart: unless-stopped
     expose:
       - 3000
     ports:
       - 3000:3000
     #depends_on:
      # - prometheus
       
   cadvisor:
     image: google/cadvisor:latest
     container_name: cadvisor
     ports:
       - 7070:8080
     volumes:
       - /:/rootfs:ro
       - /var/run:/var/run:rw
       - /sys:/sys:ro
       - /var/lib/docker/:/var/lib/docker:ro
     depends_on:
       - database



volumes:
    volume_database:
    volume_sito:
    grafana_data: {}
    volume_pro: {}
    volume_prometheus:

    #volume_pro:
 
networks:
    FrontEnd:
      driver: bridge
    BackEnd:
      driver: bridge
